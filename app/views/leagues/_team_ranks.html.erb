<table class="table table-bordered table-striped table-responsive table-players "
      data-toggle="table"
      id="leaguesTable"
>
  <thead>
    <tr>
      <th class="col-md-1">Rank</th>
      <th data-field="team_name">Team Name</th>
      <th data-field="jbr"><%= @category.upcase %></th>
    </tr>
  </thead>
  <tbody class="jbr_scores">
    <% count = 0 %>
    <% jbr_team = [] %>
    <% @teams.each do |team| %>
      <% next if team.name.include?("Waiver") %>
      <% jbr = jbr_by_team(team.id, @category) %>
      <% name = team.name %>
      <% jbr_team.push([name, jbr]) %>
    <% end %>
    <% jbr_team = jbr_team.sort_by {|k, v| v}.reverse.to_h %>
    <% jbr_for_graph = jbr_team.to_a %>
      <% jbr_team.each do |team| %>
      <tr>
        <td><%= count += 1  %></td>
        <td><%= link_to "#{team[0]}", user_league_team_path(@current_user.id, @league_id, @teams.where(name: team[0]).pluck("id")) %></td>
        <td> <%= team[1] %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<script>
 var PageData = {
      user_id: <%= params[:user_id].to_i %>,
      league_id: <%= params[:id].to_i %>
    };

$(function (){
  console.log("Doc ready is working!");
  function getLeagueChartData () {
      return [
          <% jbr_for_graph.each do |team| %>
            {name: "<%= team[0] %>",jbr: <%= team[1] %>},
          <% end %>
      ];
  };

    var leagueJBRs = [];
    var leagueTeams = [];

    var JbrLeagueRankData = getLeagueChartData();
    for (var i = 0; i < JbrLeagueRankData.length; i++) {
          var obj = JbrLeagueRankData[i];
          var team_name = obj[Object.keys(obj)[0]];
          var team_jbr = obj[Object.keys(obj)[1]];
          var decoded = he.decode(team_name);
          leagueTeams.push(decoded);
          leagueJBRs.push(team_jbr);
      }

    $('#rank_column-top').highcharts({
          chart: {
              type: 'column',
              options3d: {
                  enabled: true,
                  alpha: 15,
                  beta: 15,
                  depth: 50,
                  viewDistance: 25
              }
          },
          title: {
              text: 'Category Leaderboard'
          },
          subtitle: {
              text: 'Category: Total Overall'
          },
          plotOptions: {
              column: {
                  depth: 25
              }
          },
          xAxis: {
              categories: leagueTeams
          },
          yAxis: {
            floor: 200,
            ceiling: 800

          },
          series: [{
            data: leagueJBRs
          }]
      })
  });
</script>
